[replace_code]
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ulus Simülatörü</title>
    <style>
        :root {
            --bg-color: #ecf0f1;
            --container-bg: #fff;
            --text-color: #2c3e50;
            --primary-color: #3498db;
            --secondary-color: #1abc9c;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --success-color: #2ecc71;
            --panel-bg: #f5f7fa;
            --border-color: #dfe4ea;
            --accent-color: #5D5CDE;
            --header-color: #1abc9c;
            --input-bg: #ecf0f1;
            --tab-active-color: #5D5CDE;
        }

        .dark {
            --bg-color: #181818;
            --container-bg: #2c3e50;
            --text-color: #ecf0f1;
            --primary-color: #5D5CDE;
            --secondary-color: #1abc9c;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --success-color: #2ecc71;
            --panel-bg: #34495e;
            --border-color: #4e6a83;
            --header-color: #1abc9c;
            --input-bg: #4e6a83;
            --tab-active-color: #5D5CDE;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .game-container {
            background-color: var(--container-bg);
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            width: 95%;
            max-width: 1200px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            transition: background-color 0.3s ease;
        }

        h1 {
            text-align: center;
            color: var(--header-color);
            margin-bottom: 20px;
        }

        /* Sekme Navigasyonu */
        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            gap: 10px; /* Sekmeler arası boşluk */
            flex-wrap: wrap; /* Küçük ekranlarda sarmalama */
        }

        .tab-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px 5px 0 0; /* Üst köşeleri yuvarlak */
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.2s ease, transform 0.1s ease;
            flex-grow: 1; /* Esnek büyüme */
            min-width: 120px; /* Minimum genişlik */
        }

        @media (max-width: 768px) {
            .tab-btn {
                min-width: 90px;
                padding: 10px 12px;
                font-size: 0.9em;
            }
        }

        .tab-btn:hover {
            background-color: var(--primary-color);
            opacity: 0.9;
            transform: translateY(-2px); /* Hafif yukarı kalkma efekti */
        }

        .tab-btn.active {
            background-color: var(--tab-active-color); /* Aktif sekme rengi */
            font-weight: bold;
            border-bottom: 2px solid var(--tab-active-color); /* Aktif sekmede alt çizgi */
            transform: translateY(0); /* Sabit konum */
        }

        /* Tüm ekranları gizle */
        .game-screen {
            display: none;
            background-color: var(--container-bg); /* Tüm ekranlar için ortak arka plan */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-height: 500px; /* Ekranlar arası boşluğu korumak için */
            overflow-y: auto; /* İçerik taşarsa kaydırma */
        }

        /* Ana oyun ekranının düzenini korumak için */
        #main-screen {
            display: grid; /* Flexbox ile ana konteyneri yönettik, içini grid ile */
            grid-template-columns: 1fr 1.5fr;
            grid-template-rows: auto 1fr; /* İstatistikler ve eylemler üstte, log ve canvas altta */
            gap: 20px;
            grid-template-areas:
                "stats actions"
                "log canvas";
        }

        @media (max-width: 768px) {
            #main-screen {
                grid-template-columns: 1fr;
                grid-template-areas:
                    "stats"
                    "actions"
                    "log"
                    "canvas";
            }

            .game-container {
                padding: 15px;
                width: 98%;
            }
        }

        #main-screen.active {
            display: grid;
        }

        .stats-panel {
            grid-area: stats;
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 6px;
            border-left: 5px solid var(--secondary-color);
        }

        .stats-panel p {
            margin: 10px 0;
            font-size: 1.05em; /* Biraz küçültüldü */
        }

        .stats-panel span {
            font-weight: bold;
            color: var(--text-color);
        }

        .actions-panel {
            grid-area: actions;
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 6px;
            border-left: 5px solid var(--warning-color);
        }

        .actions-panel h2 {
            color: var(--warning-color);
            margin-top: 0;
            margin-bottom: 15px;
        }

        .action-category {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }

        .action-category:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .action-category h3 {
            color: var(--warning-color);
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background-color 0.2s ease;
        }

        button:hover {
            background-color: var(--primary-color);
            opacity: 0.9;
        }

        button:disabled {
            background-color: #7f8c8d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .log-panel {
            grid-area: log;
            background-color: var(--panel-bg);
            padding: 20px;
            border-radius: 6px;
            border-left: 5px solid #9b59b6;
            overflow-y: auto;
            max-height: 280px; /* Yüksekliği azaltıldı */
        }

        .log-panel h2 {
            color: #9b59b6;
            margin-top: 0;
            margin-bottom: 15px;
        }

        #game-log {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        #game-log li {
            background-color: var(--container-bg);
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 4px;
            font-size: 0.9em;
        }
         #game-log li.daily { 
            font-style: italic;
            color: var(--accent-color);
            opacity: 0.8;
            font-size: 0.85em;
            border-left: 3px solid var(--accent-color);
            padding-left: 10px;
        }


        #gameCanvas {
            grid-area: canvas;
            background-color: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 100%;
            height: 220px; /* Canvas Yüksekliği Azaltıldı */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1); /* İç gölge eklendi */
        }

        /* Yeni Ekranların Genel Stili */
        .game-screen h2 {
            color: var(--warning-color); 
            margin-bottom: 20px;
            text-align: center;
        }
        .game-screen h3 {
            color: var(--secondary-color);
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
        }


        .game-screen ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .game-screen li {
            background-color: var(--panel-bg);
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.05em;
        }
         .game-screen li div { 
            display: flex;
            gap: 5px;
            flex-wrap: wrap; 
        }


        .game-screen .cabinet-actions,
        .game-screen .parliament-propose,
        .game-screen .security-actions,
        .game-screen .foreign-actions,
        .game-screen .opposition-actions,
        .game-screen .reports-actions,
        .game-screen .infrastructure-actions { /* Altyapı için yeni sınıf */
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
            justify-content: center; 
            margin-bottom: 15px;
        }


        .game-screen input[type="text"],
        .game-screen input[type="number"],
        .game-screen select {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--input-bg);
            color: var(--text-color);
            font-size: 1em;
            flex-grow: 1;
            min-width: 150px;
        }

        .game-screen .parliament-note,
        .game-screen .security-note {
            font-style: italic;
            font-size: 0.9em;
            color: #bdc3c7;
            margin-top: 10px;
            text-align: center;
        }

        /* Oyun Sonu Ekranı */
        #game-over-screen {
            display: none; 
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            min-height: 500px;
        }

        #game-over-screen h1 {
            color: var(--danger-color);
            margin-bottom: 20px;
        }

        #game-over-screen p {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        #game-over-screen button {
            background-color: var(--danger-color);
            padding: 15px 30px;
            font-size: 1.2em;
            margin-top: 30px;
        }

        #game-over-screen button:hover {
            background-color: var(--danger-color);
            opacity: 0.9;
        }

        /* Meclis Action butonları */
        .parliament-action-btn {
            padding: 8px 12px;
            margin-left: 5px;
            font-size: 0.85em;
        }

        .parliament-action-btn[data-action="approve"] {
            background-color: var(--success-color);
        }
        .parliament-action-btn[data-action="approve"]:hover {
            background-color: var(--success-color);
            opacity: 0.9;
        }
        .parliament-action-btn[data-action="reject"] {
            background-color: var(--danger-color);
        }
        .parliament-action-btn[data-action="reject"]:hover {
            background-color: var(--danger-color);
            opacity: 0.9;
        }

        /* Dış İlişkiler listesi */
        #country-relations-list button, #summit-invitation-list button {
            padding: 6px 10px;
            font-size: 0.8em;
            margin-left: 5px;
        }

        #country-relations-list li, #summit-invitation-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; 
        }


        /* Dark Mode Toggle */
        .theme-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: transparent;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--text-color);
            z-index: 100;
        }

        /* Chart styles */
        #reportChartCanvas {
            background-color: var(--panel-bg);
            border-radius: 6px;
            max-width: 100%;
            height: auto;
            margin-top: 20px;
        }

        /* Yeni özellikler için stiller */
        .slider-container {
            margin: 15px 0;
        }

        .slider-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .slider-container input[type="range"] {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: var(--panel-bg);
            outline: none;
            -webkit-appearance: none;
        }

        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
        }

        .flex-row {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .input-with-buttons {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-with-buttons input {
            width: 100px;
            text-align: center;
        }

        .input-with-buttons button {
            padding: 8px 12px;
            font-size: 1em;
        }

        .minister-advice {
            background-color: var(--panel-bg);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border-left: 5px solid var(--accent-color);
        }

        .minister-advice h3 {
            margin-top: 0;
            color: var(--accent-color);
        }

        .policy-slider {
            margin: 15px 0;
        }

        .policy-slider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .policy-value {
            font-weight: bold;
        }

        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9em;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        @media (max-width: 480px) {
            button {
                padding: 8px 12px;
                font-size: 0.85em;
                margin: 3px;
            }
            
            .stats-panel p, .actions-panel h3 {
                font-size: 0.95em;
            }
             .game-screen li div {
                justify-content: flex-start; 
            }
        }
    </style>
</head>
<body>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light mode">🌓</button>
    <div class="game-container">
        <h1>Ulus Simülatörü</h1>

        <div class="tabs">
            <button class="tab-btn active" data-tab="main-screen">Ana Ekran</button>
            <button class="tab-btn" data-tab="cabinet-screen">Kabine</button>
            <button class="tab-btn" data-tab="parliament-screen">Meclis & Siyaset</button>
            <button class="tab-btn" data-tab="foreign-affairs-screen">Dış İlişkiler & Zirveler</button>
            <button class="tab-btn" data-tab="security-screen">Güvenlik & Ordu</button>
            <button class="tab-btn" data-tab="reports-screen">Raporlar & Zaman</button>
        </div>

        <div id="main-screen" class="game-screen active">
            <div class="stats-panel">
                <p>Hafta: <span id="current-week">1</span> (Gün: <span id="current-day-of-week">1</span>)</p>
                <p>Nüfus: <span id="population">10,000,000</span></p>
                <p>GSYİH: $<span id="gdp">1,000,000,000</span></p>
                <p>Enflasyon: <span id="inflation">2</span>%</p>
                <p>Halk Memnuniyeti: <span id="satisfaction">70</span>%</p>
                <p>Bütçe: $<span id="budget">100,000,000</span></p>
                <p>Vergi Oranı: <span id="tax-rate">10</span>%</p>
                <p>Hükümet Tipi: <span id="government-type-display">Demokrasi</span></p>
                <p>Siyasi İstikrar: <span id="political-stability">70</span>%</p>
                <p>Altyapı Seviyesi: <span id="infrastructure-level-display">50</span>/100</p> <p>Dış İlişkiler Skoru: <span id="foreign-relations-score">50</span></p>
                <p>Ordu Büyüklüğü: <span id="army-size-display">50000</span></p>
                 <p>Medya Özgürlüğü: <span id="media-freedom-display">7</span>/10</p>
            </div>

            <div class="actions-panel">
                <h2>Kararlar</h2>
                <div class="action-category">
                    <h3>Vergi Ayarları</h3>
                    <div class="slider-container">
                        <label for="tax-slider">Vergi Oranı: <span id="tax-slider-value">10</span>%</label>
                        <input type="range" id="tax-slider" min="5" max="30" step="0.1" value="10">
                    </div>
                    <button id="apply-tax">Vergi Oranını Uygula</button>
                </div>
                
                <div class="action-category">
                    <h3>Ekonomi</h3>
                    <div class="flex-row">
                        <label for="economy-investment">Ekonomiye Yatırım ($M):</label>
                        <div class="input-with-buttons">
                            <button id="decrease-economy-investment">-</button>
                            <input type="number" id="economy-investment" value="10" min="1" max="100">
                            <button id="increase-economy-investment">+</button>
                        </div>
                        <button id="invest-economy">Yatırım Yap</button>
                    </div>
                </div>
                
                <div class="action-category">
                    <h3>Sosyal Politikalar</h3>
                    <div class="flex-row">
                        <label for="education-investment">Eğitime Yatırım ($M):</label>
                        <div class="input-with-buttons">
                            <button id="decrease-education-investment">-</button>
                            <input type="number" id="education-investment" value="5" min="1" max="50">
                            <button id="increase-education-investment">+</button>
                        </div>
                        <button id="invest-education">Yatırım Yap</button>
                    </div>
                    <div class="flex-row">
                        <label for="health-investment">Sağlığa Yatırım ($M):</label>
                        <div class="input-with-buttons">
                            <button id="decrease-health-investment">-</button>
                            <input type="number" id="health-investment" value="7" min="1" max="50">
                            <button id="increase-health-investment">+</button>
                        </div>
                        <button id="invest-health">Yatırım Yap</button>
                    </div>
                    <div class="flex-row">
                        <label for="culture-investment">Kültüre Yatırım ($M):</label>
                        <div class="input-with-buttons">
                            <button id="decrease-culture-investment">-</button>
                            <input type="number" id="culture-investment" value="3" min="1" max="30">
                            <button id="increase-culture-investment">+</button>
                        </div>
                        <button id="promote-culture">Yatırım Yap</button>
                    </div>
                    <button id="declare-holiday">Yeni Tatil İlan Et ($2M)</button>
                </div>

                 <div class="action-category">
                    <h3>Altyapı ve Kalkınma</h3> <div class="infrastructure-actions">
                        <button id="invest-transportation-btn">Ulaşım Ağına Yatırım Yap ($30M - 4 Hafta)</button>
                        <button id="invest-energy-btn">Enerji Şebekesini Güçlendir ($40M - 6 Hafta)</button>
                    </div>
                </div>

                 <div class="action-category">
                    <h3>Yeni Politikalar</h3>
                    <button id="invest-green-energy">Yeşil Enerjiye Yatırım Yap ($20M)</button>
                    <button id="develop-defense-industry">Savunma Sanayii Geliştir ($50M)</button>
                </div>
                <button id="end-week-btn">Haftayı Bitir</button>
            </div>

            <div class="log-panel">
                <h2>Olay Günlüğü</h2>
                <ul id="game-log"></ul>
            </div>

            <canvas id="gameCanvas"></canvas>
        </div>

        <div id="cabinet-screen" class="game-screen">
            <h2>Kabine Yönetimi</h2>
            <p>Mevcut Kabine Üyeleri:</p>
            <ul id="cabinet-list">
            </ul>
            <div class="minister-advice" id="cabinet-advice">
                <h3>Bakan Raporları</h3>
                <div id="economy-minister-advice"><p><strong>Ekonomi Bakanı:</strong> <span id="economy-advice-text">...</span></p></div>
                <div id="education-minister-advice"><p><strong>Eğitim Bakanı:</strong> <span id="education-advice-text">...</span></p></div>
                <div id="health-minister-advice"><p><strong>Sağlık Bakanı:</strong> <span id="health-advice-text">...</span></p></div>
                <div id="foreign-minister-advice"><p><strong>Dışişleri Bakanı:</strong> <span id="foreign-advice-text">...</span></p></div>
                <div id="interior-minister-advice"><p><strong>İçişleri Bakanı:</strong> <span id="interior-advice-text">...</span></p></div>
                <div id="justice-minister-advice"><p><strong>Adalet Bakanı:</strong> <span id="justice-advice-text">...</span></p></div>
                <div id="defense-minister-advice"><p><strong>Savunma Bakanı:</strong> <span id="defense-advice-text">...</span></p></div>
            </div>
            <h3>Bakan Atamaları / Değişiklikleri</h3>
            <div class="cabinet-actions">
                <select id="minister-type-select">
                    <option value="economy">Ekonomi</option> <option value="education">Eğitim</option> <option value="health">Sağlık</option>
                    <option value="foreign">Dışişleri</option> <option value="interior">İçişleri</option> <option value="justice">Adalet</option>
                    <option value="defense">Savunma</option>
                </select>
                <input type="text" id="minister-name-input" placeholder="Yeni Bakan Adı">
                <button id="appoint-minister-btn">Bakan Ata / Değiştir ($500K)</button>
            </div>
        </div>

        <div id="parliament-screen" class="game-screen">
            <h2>Meclis & Siyaset</h2>
            <p>Hükümet Tipi: <span id="government-type-parliament">Demokrasi</span></p>
            <p>Meclis Desteği: <span id="parliament-support"></span>%</p>
            <p>Muhalefet Gücü: <span id="opposition-strength-display"></span>%</p>
            <h3>Medya & İfade Özgürlüğü</h3>
            <div class="policy-slider">
                <div class="policy-slider-header">
                    <label for="media-freedom-slider">Medya Özgürlüğü Politikası (Hedef: <span id="media-freedom-target-value">7</span>/10)</label>
                    <span class="policy-value" id="media-freedom-value-display">7</span>
                </div>
                <input type="range" id="media-freedom-slider" min="0" max="10" value="7">
                <button id="apply-media-policy">Medya Politikasını Güncelle</button>
            </div>
            <div class="opposition-actions">
                 <button id="start-propaganda-btn">Devlet Propagandası Başlat ($5M)</button>
                 <button id="apply-censorship-btn">Sansür Uygula</button>
            </div>
            <h3>Yasama Politikaları</h3>
            <div class="policy-slider">
                <div class="policy-slider-header"><h3>Sosyal Politikalar</h3><span class="policy-value" id="social-policy-value">5</span></div>
                <input type="range" id="social-policy-slider" min="1" max="10" value="5"><button id="apply-social-policy">Uygula</button>
            </div>
            <div class="policy-slider">
                <div class="policy-slider-header"><h3>Ekonomi Politikaları</h3><span class="policy-value" id="economic-policy-value">5</span></div>
                <input type="range" id="economic-policy-slider" min="1" max="10" value="5"><button id="apply-economic-policy">Uygula</button>
            </div>
            <h3>Gündemdeki Yasalar / Talepler</h3><ul id="parliament-agenda"></ul>
            <h3>Sizin Teklifleriniz</h3>
            <div class="parliament-propose"><input type="text" id="proposal-input" placeholder="Yeni yasa teklifi"><button id="propose-law-btn">Yasa Teklif Et</button></div>
            <h3>Muhalefet İlişkileri</h3>
            <div class="opposition-actions"><button id="meet-opposition-closed-btn">Muhalefetle Kapalı Görüş ($500K)</button><button id="meet-opposition-open-btn">Muhalefetle Açık Görüş ($200K)</button></div>
            <h3>Radikal Kararlar</h3>
            <div class="parliament-propose"><button id="call-elections">Erken Seçim ($10M)</button><button id="declare-dictatorship">Diktatörlük İlan Et</button><button id="dissolve-parliament-btn">Meclisi Feshet</button></div>
        </div>
        <div id="foreign-affairs-screen" class="game-screen"> /* ... Öncekiyle benzer ... */ </div>
        <div id="security-screen" class="game-screen"> /* ... Öncekiyle benzer ... */ </div>

        <div id="reports-screen" class="game-screen">
            <h2>Raporlar & Zaman Yönetimi</h2>
            <p>Mevcut Tarih: Hafta <span id="report-current-week">1</span>, Gün <span id="report-current-day">1</span></p>
            <div class="reports-actions">
                <button id="advance-day-btn">Günü İlerlet (1 Gün)</button>
                <button id="complete-week-reports-btn" disabled>Haftayı Tamamla</button>
            </div>
            <hr>
            <div class="minister-advice"><h3>Ekonomi Bakanlığı Raporu</h3> <p>GSYİH Değişimi (Haftalık): <span id="gdp-change-report-display">-</span></p> <p>Enflasyon Değişimi (Haftalık): <span id="inflation-change-report-display">-</span></p> <p id="economy-report-inflation">Enflasyon Analizi: <span id="inflation-analysis">...</span></p> <p id="economy-report-gdp">GSYİH Durumu: <span id="gdp-analysis">...</span></p> <p id="economy-report-advice">Öneriler: <span id="economy-recommendations">...</span></p> </div>
            <div class="minister-advice"><h3>Sosyal Politikalar Raporu</h3> <p>Eğitim Kalitesi: <span id="education-quality-report">...</span></p> <p>Sağlık Hizmetleri Kalitesi: <span id="health-quality-report">...</span></p> <p>Ulusal Bayram Sayısı: <span id="holiday-count-report">...</span></p> <p>Öneriler: <span id="social-recommendations">...</span></p> </div>
            <div class="minister-advice"><h3>Siyasi Rapor</h3> <p>Hükümet Desteği: <span id="government-support-report">...</span>%</p> <p>Meclis Desteği: <span id="parliament-support-report">...</span>%</p> <p>Siyasi İstikrar: <span id="political-stability-report">...</span>%</p> <p>Medya Özgürlüğü: <span id="media-freedom-report">...</span>/10</p> <p>Öneriler: <span id="political-recommendations">...</span></p> </div>
            <div class="minister-advice"><h3>Askeri Durum Raporu</h3> <p>Ordu Hazırlık Seviyesi: <span id="army-readiness-report">...</span></p> <p>Ordu Sadakati: <span id="army-loyalty-report">...</span></p> <p>Genelkurmay Değerlendirmesi: <span id="military-assessment-report">...</span></p> </div>
            <h3>Ekonomi Verileri (Son 10 Hafta)</h3>
            <canvas id="reportChartCanvas" width="600" height="300"></canvas>
        </div>

        <div id="game-over-screen" class="game-screen">
            <h1>Oyun Bitti!</h1>
            <p id="game-over-reason"></p>
            <p>Son Hafta: <span id="final-week"></span></p>
            <p>Son Nüfus: <span id="final-population"></span></p>
            <p>Son GSYİH: <span id="final-gdp"></span></p>
            <button id="restart-game-btn">Tekrar Oyna</button>
        </div>

    </div>

    <script>
        // --- Oyun Değişkenleri ---
        let week = 1;
        let dayOfWeek = 1; 
        let isAtWar = false;
        let governmentType = 'Demokrasi'; 
        let mediaFreedom = 7; 
        let mediaInfluence = 60; 
        let propagandaEffectWeeks = 0; 
        let infrastructureLevel = 50; // Yeni Altyapı Değişkeni
        let transportationInvestmentWeeks = 0; // Aktif ulaşım yatırımı
        let energyInvestmentWeeks = 0; // Aktif enerji yatırımı


        let population = 10000000;
        let gdp = 1000000000;
        let inflation = 2; 
        let satisfaction = 70; 
        let budget = 100000000; 
        let taxes = 10; 
        let educationSpending = 0; 
        let healthSpending = 0; 
        let cultureSpending = 0; 
        let crimeRate = 5; 
        let securityPerception = 75; 
        // let politicalSystem = 'Demokrasi'; // governmentType ile birleşti
        let politicalStability = 70; 
        let parliamentSupport = 70; 
        let foreignRelationsScore = 50; 
        let nationalHolidays = 0; 
        let armySize = 50000; 
        let militaryStrengthIndex = 50; 
        let armyUpkeepCostPerSoldier = 50; 
        let armyLoyalty = 80; 

        let socialPolicyLevel = 5; 
        let economicPolicyLevel = 5; 
        let diplomaticApproachLevel = 5; 
        let securityLevel = 5; 

        const historicalData = {
            weeks: [], gdp: [], satisfaction: [], inflation: [], politicalStability: []
        };
        
        let weeklyBudgetChange = 0; let weeklySatisfactionChange = 0; let weeklyGdpChangeFactor = 1;
        let weeklyInflationChange = 0; let weeklyPopulationChangeFactor = 1; let weeklyForeignRelationsChange = 0;
        let weeklyCrimeRateChange = 0; let weeklySecurityPerceptionChange = 0; let weeklyMilitaryStrengthChange = 0;
        let weeklyPoliticalStabilityChange = 0; let weeklyArmyLoyaltyChange = 0;
        let weeklyMediaFreedomChange = 0;
        let weeklyInfrastructureChange = 0; // Altyapı için haftalık değişim (projelerden)


        const cabinet = {
            economy: { name: 'Boş', efficiency: 0.5, corruption: 0.1 }, education: { name: 'Boş', efficiency: 0.5, corruption: 0.1 },
            health: { name: 'Boş', efficiency: 0.5, corruption: 0.1 }, foreign: { name: 'Boş', efficiency: 0.5, corruption: 0.1 },
            interior: { name: 'Boş', efficiency: 0.5, corruption: 0.1 }, justice: { name: 'Boş', efficiency: 0.5, corruption: 0.1 },
            defense: { name: 'Boş', efficiency: 0.5, corruption: 0.1 } 
        };
        const countries = { 
            'Yunanistan': { relation: 40, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 45 },
            'Bulgaristan': { relation: 55, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 35 },
            'Gürcistan': { relation: 60, tradeDeal: true, summitInvited: false, summitAccepted: false, militaryPower: 30 },
            'Ermenistan': { relation: 20, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 25 },
            'Azerbaycan': { relation: 75, tradeDeal: true, summitInvited: false, summitAccepted: false, militaryPower: 50 },
            'İran': { relation: 30, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 65 },
            'Irak': { relation: 25, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 40 },
            'Suriye': { relation: 15, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 20 }, 
            'Rusya': { relation: 45, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 90 },
            'Ukrayna': { relation: 50, tradeDeal: false, summitInvited: false, summitAccepted: false, militaryPower: 60 }
        };
        const parliamentAgenda = []; 
        let summitPlanned = false;
        let summitInvitationsSent = false;

        // --- DOM Elementleri ---
        // (Önceki kodda tanımlanan tüm DOM elementleri burada da geçerli kabul ediliyor)
        // Yeni eklenenler:
        const infrastructureLevelDisplayEl = document.getElementById('infrastructure-level-display');
        const investTransportationBtn = document.getElementById('invest-transportation-btn');
        const investEnergyBtn = document.getElementById('invest-energy-btn');

        const themeToggleBtn = document.getElementById('theme-toggle');
        const tabButtons = document.querySelectorAll('.tab-btn');
        const gameScreens = document.querySelectorAll('.game-screen');
        const currentWeekEl = document.getElementById('current-week');
        const currentDayOfWeekEl = document.getElementById('current-day-of-week'); 
        const populationEl = document.getElementById('population');
        const gdpEl = document.getElementById('gdp');
        const inflationEl = document.getElementById('inflation');
        const satisfactionEl = document.getElementById('satisfaction');
        const budgetEl = document.getElementById('budget');
        const taxRateEl = document.getElementById('tax-rate');
        const governmentTypeDisplayEl = document.getElementById('government-type-display');
        const mediaFreedomDisplayEl = document.getElementById('media-freedom-display');
        const politicalStabilityEl = document.getElementById('political-stability');
        const foreignRelationsScoreEl = document.getElementById('foreign-relations-score');
        const armySizeDisplayEl = document.getElementById('army-size-display');
        const gameLogEl = document.getElementById('game-log');
        const gameCanvas = document.getElementById('gameCanvas');
        const ctx = gameCanvas ? gameCanvas.getContext('2d') : null; // Null check
        const taxSlider = document.getElementById('tax-slider');
        const taxSliderValue = document.getElementById('tax-slider-value');
        const applyTaxBtn = document.getElementById('apply-tax');
        const economyInvestmentInput = document.getElementById('economy-investment');
        const decreaseEconomyInvestmentBtn = document.getElementById('decrease-economy-investment');
        const increaseEconomyInvestmentBtn = document.getElementById('increase-economy-investment');
        const investEconomyBtn = document.getElementById('invest-economy');
        const educationInvestmentInput = document.getElementById('education-investment');
        const decreaseEducationInvestmentBtn = document.getElementById('decrease-education-investment');
        const increaseEducationInvestmentBtn = document.getElementById('increase-education-investment');
        const investEducationBtn = document.getElementById('invest-education');
        const healthInvestmentInput = document.getElementById('health-investment');
        const decreaseHealthInvestmentBtn = document.getElementById('decrease-health-investment');
        const increaseHealthInvestmentBtn = document.getElementById('increase-health-investment');
        const investHealthBtn = document.getElementById('invest-health');
        const cultureInvestmentInput = document.getElementById('culture-investment');
        const decreaseCultureInvestmentBtn = document.getElementById('decrease-culture-investment');
        const increaseCultureInvestmentBtn = document.getElementById('increase-culture-investment');
        const promoteCultureBtn = document.getElementById('promote-culture');
        const declareHolidayBtn = document.getElementById('declare-holiday');
        const endWeekBtn = document.getElementById('end-week-btn');
        const investGreenEnergyBtn = document.getElementById('invest-green-energy');
        const developDefenseIndustryBtn = document.getElementById('develop-defense-industry');
        const socialPolicySlider = document.getElementById('social-policy-slider');
        const socialPolicyValue = document.getElementById('social-policy-value');
        const applySocialPolicyBtn = document.getElementById('apply-social-policy');
        const economicPolicySlider = document.getElementById('economic-policy-slider');
        const economicPolicyValue = document.getElementById('economic-policy-value');
        const applyEconomicPolicyBtn = document.getElementById('apply-economic-policy');
        const diplomaticApproachSlider = document.getElementById('diplomatic-approach-slider');
        const diplomaticApproachValue = document.getElementById('diplomatic-approach-value');
        const applyDiplomaticApproachBtn = document.getElementById('apply-diplomatic-approach');
        const securityLevelSlider = document.getElementById('security-level-slider');
        const securityLevelValue = document.getElementById('security-level-value');
        const applySecurityLevelBtn = document.getElementById('apply-security-level');
        const policeBudgetInput = document.getElementById('police-budget');
        const decreasePoliceBudgetBtn = document.getElementById('decrease-police-budget');
        const increasePoliceBudgetBtn = document.getElementById('increase-police-budget');
        const increasePoliceBudgetBtnApply = document.getElementById('increase-police-budget-btn');
        const crimeRateEl = document.getElementById('crime-rate');
        const securityPerceptionEl = document.getElementById('security-perception');
        const armySizeSecurityEl = document.getElementById('army-size-security');
        const militaryStrengthIndexEl = document.getElementById('military-strength-index');
        const armyLoyaltyDisplayEl = document.getElementById('army-loyalty-display');
        const reformJusticeBtn = document.getElementById('reform-justice');
        const surveillanceProgramBtn = document.getElementById('surveillance-program');
        const crackdownDissentBtn = document.getElementById('crackdown-dissent');
        const recruitSoldiersInput = document.getElementById('recruit-soldiers-input');
        const decreaseRecruitsBtn = document.getElementById('decrease-recruits');
        const increaseRecruitsBtn = document.getElementById('increase-recruits');
        const recruitSoldiersBtn = document.getElementById('recruit-soldiers-btn');
        const planWarBtn = document.getElementById('plan-war-btn');
        const militaryExerciseBtn = document.getElementById('military-exercise-btn');
        const militaryCouncilMeetingBtn = document.getElementById('military-council-meeting-btn');
        const cabinetListEl = document.getElementById('cabinet-list');
        const ministerTypeSelect = document.getElementById('minister-type-select');
        const ministerNameInput = document.getElementById('minister-name-input');
        const appointMinisterBtn = document.getElementById('appoint-minister-btn');
        const economyAdviceText = document.getElementById('economy-advice-text');
        const educationAdviceText = document.getElementById('education-advice-text');
        const healthAdviceText = document.getElementById('health-advice-text');
        const foreignAdviceText = document.getElementById('foreign-advice-text');
        const interiorAdviceText = document.getElementById('interior-advice-text');
        const justiceAdviceText = document.getElementById('justice-advice-text');
        const defenseAdviceText = document.getElementById('defense-advice-text');
        const inflationAnalysisEl = document.getElementById('inflation-analysis');
        const gdpAnalysisEl = document.getElementById('gdp-analysis');
        const economyRecommendationsEl = document.getElementById('economy-recommendations');
        const socialRecommendationsEl = document.getElementById('social-recommendations');
        const politicalRecommendationsEl = document.getElementById('political-recommendations');
        const parliamentSupportEl = document.getElementById('parliament-support');
        const oppositionStrengthDisplayEl = document.getElementById('opposition-strength-display');
        const governmentTypeParliamentEl = document.getElementById('government-type-parliament');
        const mediaFreedomSlider = document.getElementById('media-freedom-slider');
        const mediaFreedomTargetValueEl = document.getElementById('media-freedom-target-value');
        const mediaFreedomValueDisplayEl = document.getElementById('media-freedom-value-display');
        const applyMediaPolicyBtn = document.getElementById('apply-media-policy');
        const startPropagandaBtn = document.getElementById('start-propaganda-btn');
        const applyCensorshipBtn = document.getElementById('apply-censorship-btn');
        const parliamentAgendaList = document.getElementById('parliament-agenda');
        const proposalInput = document.getElementById('proposal-input');
        const proposeLawBtn = document.getElementById('propose-law-btn');
        const callElectionsBtn = document.getElementById('call-elections');
        const declareDictatorshipBtn = document.getElementById('declare-dictatorship');
        const dissolveParliamentBtn = document.getElementById('dissolve-parliament-btn');
        const meetOppositionClosedBtn = document.getElementById('meet-opposition-closed-btn');
        const meetOppositionOpenBtn = document.getElementById('meet-opposition-open-btn');
        const foreignRelationsDisplayEl = document.getElementById('foreign-relations-display');
        const countryRelationsList = document.getElementById('country-relations-list');
        const foreignEventsList = document.getElementById('foreign-events-list');
        const globalSummitBtn = document.getElementById('global-summit-btn');
        const signTradeDealBtn = document.getElementById('sign-trade-deal');
        const improveRelationsBtn = document.getElementById('improve-relations');
        const declareWarBtn = document.getElementById('declare-war');
        const createSummitBtn = document.getElementById('create-summit-btn');
        const summitInvitationListEl = document.getElementById('summit-invitation-list');
        const sendSummitInvitationsBtn = document.getElementById('send-summit-invitations-btn');
        const advanceDayBtn = document.getElementById('advance-day-btn');
        const completeWeekReportsBtn = document.getElementById('complete-week-reports-btn');
        const reportCurrentWeekEl = document.getElementById('report-current-week');
        const reportCurrentDayEl = document.getElementById('report-current-day');
        const gdpChangeReportDisplayEl = document.getElementById('gdp-change-report-display');
        const inflationChangeReportDisplayEl = document.getElementById('inflation-change-report-display');
        const educationQualityReportEl = document.getElementById('education-quality-report');
        const healthQualityReportEl = document.getElementById('health-quality-report');
        const holidayCountReportEl = document.getElementById('holiday-count-report');
        const governmentSupportReportEl = document.getElementById('government-support-report');
        const parliamentSupportReportEl = document.getElementById('parliament-support-report');
        const politicalStabilityReportEl = document.getElementById('political-stability-report');
        const mediaFreedomReportEl = document.getElementById('media-freedom-report');
        const armyReadinessReportEl = document.getElementById('army-readiness-report');
        const armyLoyaltyReportEl = document.getElementById('army-loyalty-report');
        const militaryAssessmentReportEl = document.getElementById('military-assessment-report');
        const reportChartCanvas = document.getElementById('reportChartCanvas');
        const reportChartCtx = reportChartCanvas ? reportChartCanvas.getContext('2d') : null; // Null check
        const gameOverScreen = document.getElementById('game-over-screen');
        const gameOverReasonEl = document.getElementById('game-over-reason');
        const finalWeekEl = document.getElementById('final-week');
        const finalPopulationEl = document.getElementById('final-population');
        const finalGdpEl = document.getElementById('final-gdp');
        const restartGameBtn = document.getElementById('restart-game-btn');
        
        
        function initTheme() { 
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
                if(themeToggleBtn) themeToggleBtn.textContent = '☀️';
            } else {
                 document.documentElement.classList.remove('dark');
                if(themeToggleBtn) themeToggleBtn.textContent = '🌙';
            }
        }
        
        function showScreen(screenId) { 
            if(gameScreens) gameScreens.forEach(screen => { if(screen) screen.style.display = 'none'; });
            const targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                 targetScreen.style.display = screenId === 'main-screen' ? 'grid' : 'block';
            }

            if(tabButtons) tabButtons.forEach(btn => {
                if(btn) btn.classList.toggle('active', btn.dataset.tab === screenId);
            });

            const mainEndWeekBtn = document.getElementById('end-week-btn'); 
            const reportsAdvanceDayBtn = document.getElementById('advance-day-btn');
            const reportsCompleteWeekBtn = document.getElementById('complete-week-reports-btn');

            if (screenId === 'reports-screen') {
                if(mainEndWeekBtn) mainEndWeekBtn.style.display = 'none'; 
                if(reportsAdvanceDayBtn) reportsAdvanceDayBtn.style.display = 'inline-block';
                if(reportsCompleteWeekBtn) reportsCompleteWeekBtn.style.display = 'inline-block';
                if(reportsAdvanceDayBtn) reportsAdvanceDayBtn.disabled = isAtWar || (dayOfWeek > 7); 
                if(reportsCompleteWeekBtn) reportsCompleteWeekBtn.disabled = isAtWar || (dayOfWeek <= 7 && week > 0); 
                if(typeof updateReports === 'function') updateReports(); 
            } else {
                if(mainEndWeekBtn) mainEndWeekBtn.style.display = 'inline-block'; 
                if(reportsAdvanceDayBtn) reportsAdvanceDayBtn.style.display = 'none';
                if(reportsCompleteWeekBtn) reportsCompleteWeekBtn.style.display = 'none';
                if(mainEndWeekBtn) mainEndWeekBtn.disabled = isAtWar; 
            }


            if (screenId === 'cabinet-screen' && typeof updateMinisterAdvice === 'function') updateMinisterAdvice();
            else if (screenId === 'foreign-affairs-screen' && typeof updateForeignRelationsDisplay === 'function') { updateForeignRelationsDisplay(); if(typeof updateSummitInvitationList === 'function') updateSummitInvitationList(); }
            else if (screenId === 'security-screen' && typeof getArmyLoyaltyStatus === 'function') {
                if(armySizeSecurityEl) armySizeSecurityEl.textContent = armySize.toLocaleString();
                if(militaryStrengthIndexEl) militaryStrengthIndexEl.textContent = militaryStrengthIndex.toFixed(0);
                if(armyLoyaltyDisplayEl) armyLoyaltyDisplayEl.textContent = getArmyLoyaltyStatus();
            } else if (screenId === 'parliament-screen' && typeof updateParliamentDisplay === 'function') {
                if(oppositionStrengthDisplayEl) oppositionStrengthDisplayEl.textContent = `${(governmentType === 'Demokrasi' || governmentType === 'Otoriter Demokrasi' ? (100 - parliamentSupport) : 'N/A').toFixed(0)}%`;
                if(governmentTypeParliamentEl) governmentTypeParliamentEl.textContent = governmentType;
                if(mediaFreedomValueDisplayEl) mediaFreedomValueDisplayEl.textContent = mediaFreedom.toFixed(1);
                if(mediaFreedomSlider) mediaFreedomSlider.value = mediaFreedom;
                if(mediaFreedomTargetValueEl) mediaFreedomTargetValueEl.textContent = mediaFreedom.toFixed(1); 
                updateParliamentDisplay(); 
            }
        }
        
        function getArmyLoyaltyStatus() { 
            if (armyLoyalty >= 80) return "Çok Yüksek";
            if (armyLoyalty >= 60) return "Yüksek";
            if (armyLoyalty >= 40) return "Orta";
            if (armyLoyalty >= 20) return "Düşük";
            return "Çok Düşük (İsyan Riski!)";
        }
        
        function resizeCanvas() { 
            const mainCanvasContainer = gameCanvas ? gameCanvas.parentElement : null;
            if (mainCanvasContainer && gameCanvas) { 
                 gameCanvas.width = mainCanvasContainer.offsetWidth;
                 gameCanvas.height = 220;  // Yükseklik azaltıldı
                 if(typeof drawCanvasStats === 'function') drawCanvasStats();
            }
            const reportCanvasContainer = reportChartCanvas ? reportChartCanvas.parentElement : null;
            if (reportCanvasContainer && reportChartCanvas) { 
                reportChartCanvas.width = reportCanvasContainer.offsetWidth > 0 ? reportCanvasContainer.offsetWidth * 0.98 : 300; 
                reportChartCanvas.height = 300; 
                if(typeof drawReportChart === 'function') drawReportChart(); 
            }
         }
        
        function resetGame() {
            week = 1; dayOfWeek = 1; isAtWar = false;
            governmentType = 'Demokrasi'; mediaFreedom = 7; mediaInfluence = 60; propagandaEffectWeeks = 0;
            infrastructureLevel = 50; transportationInvestmentWeeks = 0; energyInvestmentWeeks = 0;

            population = 10000000; gdp = 1000000000; inflation = 2; satisfaction = 70;
            budget = 100000000; taxes = 10; educationSpending = 0; healthSpending = 0; cultureSpending = 0;
            crimeRate = 5; securityPerception = 75; 
            politicalStability = 70;
            parliamentSupport = (governmentType === 'Demokrasi' || governmentType === 'Otoriter Demokrasi') ? 70 : 100; 
            foreignRelationsScore = 50; nationalHolidays = 0;
            armySize = 50000; militaryStrengthIndex = 50; armyLoyalty = 80;
            summitPlanned = false; summitInvitationsSent = false;
            
            socialPolicyLevel = 5; economicPolicyLevel = 5; diplomaticApproachLevel = 5; securityLevel = 5;
            
            if(taxSlider) taxSlider.value = taxes; if(taxSliderValue) taxSliderValue.textContent = taxes;
            if(socialPolicySlider) socialPolicySlider.value = socialPolicyLevel; if(socialPolicyValue) socialPolicyValue.textContent = socialPolicyLevel;
            if(economicPolicySlider) economicPolicySlider.value = economicPolicyLevel; if(economicPolicyValue) economicPolicyValue.textContent = economicPolicyLevel;
            if(diplomaticApproachSlider) diplomaticApproachSlider.value = diplomaticApproachLevel; if(diplomaticApproachValue) diplomaticApproachValue.textContent = diplomaticApproachLevel;
            if(securityLevelSlider) securityLevelSlider.value = securityLevel; if(securityLevelValue) securityLevelValue.textContent = securityLevel;
            if(mediaFreedomSlider) { mediaFreedomSlider.value = mediaFreedom; if(mediaFreedomTargetValueEl) mediaFreedomTargetValueEl.textContent = mediaFreedom.toFixed(1); if(mediaFreedomValueDisplayEl) mediaFreedomValueDisplayEl.textContent = mediaFreedom.toFixed(1);}


             ['weekly'].forEach(prefix => { 
                for (const key in window) {
                    if (key.startsWith(prefix) && typeof window[key] === 'number') {
                         if (key.includes('Factor')) window[key] = 1; else window[key] = 0;
                    }
                }
            });


            historicalData.weeks = []; historicalData.gdp = []; historicalData.satisfaction = [];
            historicalData.inflation = []; historicalData.politicalStability = [];

            for (const type in cabinet) {
                cabinet[type] = { name: 'Boş', efficiency: 0.4 + Math.random() * 0.3, corruption: 0.05 + Math.random() * 0.2 };
            }
            if(typeof updateCabinetDisplay === 'function') updateCabinetDisplay();
            const initialCountries = { 
                'Yunanistan': { relation: 30 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 40 + Math.floor(Math.random()*11)-5 },
                'Bulgaristan': { relation: 45 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 30 + Math.floor(Math.random()*11)-5 },
                // ... (Diğer ülkeler önceki kodla aynı)
                'Gürcistan': { relation: 50 + Math.floor(Math.random()*21)-10, tradeDeal: Math.random() < 0.3, militaryPower: 25 + Math.floor(Math.random()*11)-5 },
                'Ermenistan': { relation: 15 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 20 + Math.floor(Math.random()*11)-5 },
                'Azerbaycan': { relation: 65 + Math.floor(Math.random()*21)-10, tradeDeal: Math.random() < 0.5, militaryPower: 45 + Math.floor(Math.random()*11)-5 },
                'İran': { relation: 25 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 60 + Math.floor(Math.random()*11)-5 },
                'Irak': { relation: 20 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 35 + Math.floor(Math.random()*11)-5 },
                'Suriye': { relation: 10 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 15 + Math.floor(Math.random()*11)-5 },
                'Rusya': { relation: 40 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 85 + Math.floor(Math.random()*11)-5 },
                'Ukrayna': { relation: 45 + Math.floor(Math.random()*21)-10, tradeDeal: false, militaryPower: 55 + Math.floor(Math.random()*11)-5 }
            };
             for (const countryName in countries) { 
                if (initialCountries[countryName]) {
                    countries[countryName].relation = Math.max(0, Math.min(100, initialCountries[countryName].relation));
                    countries[countryName].tradeDeal = initialCountries[countryName].tradeDeal;
                    countries[countryName].militaryPower = initialCountries[countryName].militaryPower;
                    countries[countryName].summitInvited = false;
                    countries[countryName].summitAccepted = false;
                }
            }
            if(typeof updateForeignRelationsDisplay === 'function') updateForeignRelationsDisplay();
            if(typeof updateSummitInvitationList === 'function') updateSummitInvitationList();

            parliamentAgenda.length = 0; 
            if(typeof updateParliamentDisplay === 'function') updateParliamentDisplay();
            if(foreignEventsList) foreignEventsList.innerHTML = ''; 
            if(gameLogEl) gameLogEl.innerHTML = ''; 
            
            if(gameOverScreen) gameOverScreen.style.display = 'none';
            
            addLog('Ulus Simülatörü Başladı! Yeni bir oyun...');
            updateGameStats(); 
            if(typeof updateMinisterAdvice === 'function') updateMinisterAdvice(); 
            if(typeof updateReports === 'function') updateReports();
            resizeCanvas(); 
            enableAllActionButtons(); 
            if(endWeekBtn) endWeekBtn.disabled = false; 
            showScreen('main-screen'); 
        }

        function updateGameStats() { 
            if(currentWeekEl) currentWeekEl.textContent = week;
            if(currentDayOfWeekEl) currentDayOfWeekEl.textContent = dayOfWeek; 
            if(populationEl) populationEl.textContent = population.toLocaleString();
            if(gdpEl) gdpEl.textContent = gdp.toLocaleString();
            if(inflationEl) inflationEl.textContent = inflation.toFixed(1);
            if(satisfactionEl) satisfactionEl.textContent = satisfaction.toFixed(1);
            if(budgetEl) budgetEl.textContent = budget.toLocaleString();
            if(taxRateEl) taxRateEl.textContent = taxes.toFixed(1);
            //if(politicalSystemEl) politicalSystemEl.textContent = politicalSystem; 
            if(governmentTypeDisplayEl) governmentTypeDisplayEl.textContent = governmentType; 
            if(mediaFreedomDisplayEl) mediaFreedomDisplayEl.textContent = `${mediaFreedom.toFixed(1)}/10`; 
            if(politicalStabilityEl) politicalStabilityEl.textContent = politicalStability.toFixed(1) + '%';
            if(infrastructureLevelDisplayEl) infrastructureLevelDisplayEl.textContent = `${infrastructureLevel.toFixed(0)}/100`; // Altyapı
            if(foreignRelationsScoreEl) foreignRelationsScoreEl.textContent = foreignRelationsScore.toFixed(0);
            if(armySizeDisplayEl) armySizeDisplayEl.textContent = armySize.toLocaleString(); 
            if(armySizeSecurityEl) armySizeSecurityEl.textContent = armySize.toLocaleString(); 
            if(militaryStrengthIndexEl) militaryStrengthIndexEl.textContent = militaryStrengthIndex.toFixed(0);
            if(armyLoyaltyDisplayEl) armyLoyaltyDisplayEl.textContent = getArmyLoyaltyStatus();

            if(crimeRateEl) crimeRateEl.textContent = crimeRate.toFixed(1);
            if(securityPerceptionEl) securityPerceptionEl.textContent = securityPerception.toFixed(1);
            
            if(reportCurrentWeekEl) reportCurrentWeekEl.textContent = week; 
            if(reportCurrentDayEl) reportCurrentDayEl.textContent = dayOfWeek;

            if(typeof drawCanvasStats === 'function') drawCanvasStats(); 
            const reportsScreen = document.getElementById('reports-screen');
            if(reportsScreen && reportsScreen.style.display !== 'none' && typeof updateReports === 'function') {
                 updateReports(); 
            }
        }

        function addLog(message, type = 'info', isDaily = false) { 
            if(!gameLogEl) return;
            const listItem = document.createElement('li');
            const timePrefix = isDaily ? `H${week}, G${dayOfWeek}: ` : `Hafta ${week}: `;
            listItem.textContent = timePrefix + message;

            if (type === 'warning') listItem.style.color = 'var(--warning-color)';
            else if (type === 'danger') listItem.style.color = 'var(--danger-color)';
            else if (type === 'success') listItem.style.color = 'var(--success-color)';
            else if (type === 'event') { listItem.style.color = 'var(--accent-color)'; listItem.style.fontWeight = 'bold';}
            
            if(isDaily) listItem.classList.add('daily');

            gameLogEl.prepend(listItem); 
            if (gameLogEl.children.length > 80) { 
                gameLogEl.removeChild(gameLogEl.lastChild);
            }
         }

        function drawCanvasStats() { 
            if (!gameCanvas || !ctx) return;
            ctx.clearRect(0, 0, gameCanvas.width, gameCanvas.height);
            const barHeight = 15; // Bar yüksekliği azaltıldı
            const barWidth = Math.max(50, gameCanvas.width - 120); 
            const startX = 100; 
            let currentY = 20; // Başlangıç Y pozisyonu ayarlandı
            const verticalSpacing = barHeight + 10; // Barlar arası boşluk
            const textColor = getComputedStyle(document.documentElement).getPropertyValue('--text-color');
            const borderColor = getComputedStyle(document.documentElement).getPropertyValue('--border-color');
            ctx.font = '13px Arial'; // Font boyutu biraz küçültüldü

            function drawBar(label, value, maxValue, colorFunc) {
                ctx.fillStyle = textColor;
                ctx.fillText(label, 10, currentY + barHeight / 2 + 4); // Yazı pozisyonu ayarlandı
                const fillWidth = Math.max(0,(value / maxValue) * barWidth); // Negatif genişlik olmasın
                ctx.fillStyle = colorFunc(value, maxValue);
                ctx.fillRect(startX, currentY, fillWidth, barHeight);
                ctx.strokeStyle = borderColor;
                ctx.strokeRect(startX, currentY, barWidth, barHeight);
                ctx.fillStyle = textColor;
                ctx.fillText(`${value.toFixed(1)}${maxValue === 100 || label.includes('%') ? '%' : ''}`, startX + barWidth + 5, currentY + barHeight / 2 + 4);
                currentY += verticalSpacing; 
            }

            drawBar('Memnuniyet:', satisfaction, 100, (val) => `rgb(${255 - (val * 2.55)}, ${val * 2.55}, 0)`);
            drawBar('Enflasyon:', Math.min(inflation, 25), 25, (val, max) => `rgb(${(val/max) * 255}, ${255 - ((val/max) * 255)}, 0)`); 
            drawBar('Dış İlişkiler:', foreignRelationsScore, 100, (val) => `rgb(0, ${val * 1.5}, ${255 - (val * 1.5)})`); 
            drawBar('Suç Oranı:', Math.min(crimeRate, 25), 25, (val, max) => `rgb(${(val/max) * 255}, ${150 - ((val/max) * 150)}, 0)`); 
            drawBar('İstikrar:', politicalStability, 100, (val) => `rgb(${val*0.5}, ${val * 2}, ${255 - val * 2})`);
            drawBar('Altyapı:', infrastructureLevel, 100, (val) => `rgb(${val * 1}, ${val*1.5}, ${val*2})`); // Altyapı barı
         }

        function drawReportChart() { /* ... Öncekiyle aynı ... */ }
        function updateMinisterAdvice() { /* ... Öncekiyle aynı ... */ }
        function updateMinisterReports() { /* ... Öncekiyle aynı, infrastructureLevelDisplayEl eklenebilir ... */
            if(infrastructureLevelDisplayEl) infrastructureLevelDisplayEl.textContent = `${infrastructureLevel.toFixed(0)}/100`;
        }
        let gdpGrowthFactorGlobalForReport = 1; 
        let inflationChangeGlobalForReport = 0;

        function enableAllActionButtons(forceEnable = false) { /* ... Öncekiyle aynı, buton id'leri kontrol edilecek ... */
            const allActionButtons = document.querySelectorAll('.actions-panel button, .cabinet-actions button, .parliament-propose button, .security-actions button, .foreign-actions button, .opposition-actions button, .reports-actions button, .infrastructure-actions button');
            
            allActionButtons.forEach(button => {
                if (!button || button.id === 'theme-toggle' || button.id === 'restart-game-btn') return; 
                if (button.id === 'end-week-btn' || button.id === 'advance-day-btn' || button.id === 'complete-week-reports-btn') return;
                button.disabled = forceEnable ? false : isAtWar; 
            });

            const mainEndWeekBtn = document.getElementById('end-week-btn');
            const reportsAdvanceDayBtn = document.getElementById('advance-day-btn');
            const reportsCompleteWeekBtn = document.getElementById('complete-week-reports-btn');

            if (isAtWar && !forceEnable) { 
                if(mainEndWeekBtn) mainEndWeekBtn.disabled = true; 
                if(reportsAdvanceDayBtn) reportsAdvanceDayBtn.disabled = true; 
                if(reportsCompleteWeekBtn) reportsCompleteWeekBtn.disabled = true;
                 // Savaşla ilgili özel butonlar burada yönetilebilir
                if(investTransportationBtn) investTransportationBtn.disabled = true; // Savaşta altyapı yatırımı olmaz
                if(investEnergyBtn) investEnergyBtn.disabled = true;
                return; 
            }
            
            if (!forceEnable) {
                 const isDemocracy = (governmentType === 'Demokrasi');
                 const isAuthoritarian = (governmentType === 'Otoriter Demokrasi' || governmentType === 'Diktatörlük');
                 const isDictatorship = (governmentType === 'Diktatörlük');

                if(declareDictatorshipBtn) declareDictatorshipBtn.disabled = isDictatorship || (isDemocracy && (satisfaction < 25 || armyLoyalty < 40 || politicalStability < 25));
                if(crackdownDissentBtn) crackdownDissentBtn.disabled = isDemocracy; 
                if(callElectionsBtn) callElectionsBtn.disabled = isDictatorship || (!isDemocracy && governmentType !== 'Otoriter Demokrasi');
                if(dissolveParliamentBtn) dissolveParliamentBtn.disabled = isDictatorship || (isDemocracy && (parliamentSupport > 35 || politicalStability > 45));
                if(meetOppositionClosedBtn) meetOppositionClosedBtn.disabled = isDictatorship; 
                if(meetOppositionOpenBtn) meetOppositionOpenBtn.disabled = isDictatorship;
                if(proposeLawBtn) proposeLawBtn.disabled = isDictatorship;
                if(applyCensorshipBtn) applyCensorshipBtn.disabled = isDemocracy && mediaFreedom > 5; 
                if(startPropagandaBtn) startPropagandaBtn.disabled = isDictatorship && mediaFreedom < 2; 
            }

            if(sendSummitInvitationsBtn) sendSummitInvitationsBtn.disabled = !summitPlanned || summitInvitationsSent || getSelectedSummitInvitees().length === 0;
            if(createSummitBtn) createSummitBtn.disabled = summitPlanned; 
            if(investTransportationBtn) investTransportationBtn.disabled = transportationInvestmentWeeks > 0 || isAtWar;
            if(investEnergyBtn) investEnergyBtn.disabled = energyInvestmentWeeks > 0 || isAtWar;


            if(mainEndWeekBtn) mainEndWeekBtn.disabled = isAtWar || (document.getElementById('reports-screen').style.display !== 'none');
            if(reportsAdvanceDayBtn) reportsAdvanceDayBtn.disabled = isAtWar || (dayOfWeek > 7);
            if(reportsCompleteWeekBtn) reportsCompleteWeekBtn.disabled = isAtWar || (dayOfWeek <= 7 && week > 0);
         }

        function gameOver(reason, type = 'normal') { /* ... Öncekiyle aynı ... */
            addLog(`Oyun Bitti! ${reason}`, 'danger');
            isAtWar = false; 
            enableAllActionButtons(false); 
            if(endWeekBtn) endWeekBtn.disabled = true;
            if(advanceDayBtn) advanceDayBtn.disabled = true;
            if(completeWeekReportsBtn) completeWeekReportsBtn.disabled = true;

            if(gameOverReasonEl) gameOverReasonEl.textContent = reason;
            if(finalWeekEl) finalWeekEl.textContent = week;
            if(finalPopulationEl) finalPopulationEl.textContent = population.toLocaleString();
            if(finalGdpEl) finalGdpEl.textContent = gdp.toLocaleString();

            if (type === 'coup' && gameOverReasonEl) gameOverReasonEl.innerHTML += "<br>Ordu yönetime el koydu!";
            else if (type === 'civil_war' && gameOverReasonEl) gameOverReasonEl.innerHTML += "<br>Ülke iç savaşa sürüklendi ve bölündü!";
            else if (type === 'retirement' && gameOverReasonEl) gameOverReasonEl.innerHTML += "<br>Huzurlu bir emeklilik sizi bekliyor.";
            else if (type === 'dictator_win' && gameOverReasonEl) gameOverReasonEl.innerHTML += "<br>Mutlak gücünüzü ilan ettiniz.";
            
            const reportsScreen = document.getElementById('reports-screen');
            if(reportsScreen) showScreen('game-over-screen'); // null check eklendi
         }
        
        function applyAccumulatedWeeklyChanges() { /* ... Altyapı eklendi ... */
            budget += weeklyBudgetChange;
            satisfaction += weeklySatisfactionChange;
            gdp *= weeklyGdpChangeFactor;
            inflation += weeklyInflationChange;
            population = Math.round(population * weeklyPopulationChangeFactor);
            foreignRelationsScore += weeklyForeignRelationsChange;
            crimeRate += weeklyCrimeRateChange;
            securityPerception += weeklySecurityPerceptionChange;
            militaryStrengthIndex += weeklyMilitaryStrengthChange;
            politicalStability += weeklyPoliticalStabilityChange;
            armyLoyalty += weeklyArmyLoyaltyChange;
            mediaFreedom += weeklyMediaFreedomChange;
            infrastructureLevel += weeklyInfrastructureChange; // Altyapı


            satisfaction = Math.max(0, Math.min(100, satisfaction));
            inflation = Math.max(0.05, Math.min(50, inflation));
            population = Math.max(10000, population); 
            foreignRelationsScore = Math.max(0, Math.min(100, foreignRelationsScore));
            crimeRate = Math.max(0.1, Math.min(30, crimeRate));
            securityPerception = Math.max(0, Math.min(100, securityPerception));
            militaryStrengthIndex = Math.max(5, Math.min(100, militaryStrengthIndex));
            politicalStability = Math.max(0, Math.min(100, politicalStability));
            armyLoyalty = Math.max(0, Math.min(100, armyLoyalty));
            mediaFreedom = Math.max(0, Math.min(10, mediaFreedom));
            infrastructureLevel = Math.max(0, Math.min(100, infrastructureLevel)); // Altyapı sınırı
            gdp = Math.max(population * 10, gdp); 

            weeklyBudgetChange = 0; weeklySatisfactionChange = 0; weeklyGdpChangeFactor = 1;
            weeklyInflationChange = 0; weeklyPopulationChangeFactor = 1; weeklyForeignRelationsChange = 0;
            weeklyCrimeRateChange = 0; weeklySecurityPerceptionChange = 0; weeklyMilitaryStrengthChange = 0;
            weeklyPoliticalStabilityChange = 0; weeklyArmyLoyaltyChange = 0; weeklyMediaFreedomChange = 0;
            weeklyInfrastructureChange = 0; // Altyapı sıfırlama
        }

        function advanceOneDay() { /* ... Öncekiyle aynı, sadece applyAccumulatedWeeklyChanges() çağrılıyor ... */
            if (isAtWar) { addLog("Savaş devam ederken günü bu şekilde ilerletemezsiniz!", "warning", true); return; }
            const goScreen = document.getElementById('game-over-screen'); // Null check için
            if (goScreen && goScreen.style.display !== 'none') { addLog("Oyun bitti, zamanı ilerletemezsiniz.", "warning", true); return;}

            addLog("Yeni bir gün başladı...", "info", true);
            
            const dailyFactor = 1/7;

            let currentDailyBudgetChange = 0;
            let dailyRevenue = (population * gdp * (taxes / 520000) * (1 - cabinet.economy.corruption*0.5)) * dailyFactor;
            currentDailyBudgetChange += dailyRevenue;
            let dailyTotalSpending = 0;
            dailyTotalSpending += (educationSpending * (1 + cabinet.education.corruption*0.8)) * dailyFactor;
            dailyTotalSpending += (healthSpending * (1 + cabinet.health.corruption*0.8)) * dailyFactor;
            dailyTotalSpending += (cultureSpending * (1 + (cabinet.economy.corruption || 0.1)*0.8)) * dailyFactor; 
            dailyTotalSpending += (socialPolicyLevel * 500000 * (1 + socialPolicyLevel/20)) * dailyFactor;
            const dailyArmyMaintenance = armySize * armyUpkeepCostPerSoldier * (1 + (militaryStrengthIndex - 50) / 150) * (1 - cabinet.defense.efficiency*0.1 + cabinet.defense.corruption*0.3) * dailyFactor;
            dailyTotalSpending += dailyArmyMaintenance;
            currentDailyBudgetChange -= dailyTotalSpending;
            weeklyBudgetChange += currentDailyBudgetChange; 

            let dailyGdpGrowth = ( (Math.random() - 0.45) * 0.004 * cabinet.economy.efficiency + (economicPolicyLevel - 5) * 0.0015 - inflation/500 + infrastructureLevel/10000) * dailyFactor; // Altyapı etkisi
            weeklyGdpChangeFactor *= (1 + dailyGdpGrowth);

            let dailyInfChange = ( (currentDailyBudgetChange / (gdp +1) * 100) * 0.0003 + (Math.random() - 0.5) * 0.08 ) * dailyFactor;
            if (economicPolicyLevel > 6) dailyInfChange += (economicPolicyLevel - 6) * 0.15 * dailyFactor;
            else if (economicPolicyLevel < 4) dailyInfChange -= (4 - economicPolicyLevel) * 0.08 * dailyFactor;
             dailyInfChange -= infrastructureLevel / 20000 * dailyFactor; // İyi altyapı enflasyonu düşürebilir
            weeklyInflationChange += dailyInfChange;

            let dailyPopGrowth = ( (satisfaction / 150000) - (inflation / 70000) + (healthSpending / (gdp+1) * 0.0002) ) * dailyFactor;
            weeklyPopulationChangeFactor *= (1 + dailyPopGrowth);
            
            let dailySatDelta = 0;
            dailySatDelta -= (taxes / 60) * dailyFactor;
            dailySatDelta += ((educationSpending / 600000 * cabinet.education.efficiency) + (healthSpending / 600000 * cabinet.health.efficiency) + (cultureSpending / 400000)) * dailyFactor;
            dailySatDelta += (socialPolicyLevel - 5) * 0.6 * dailyFactor;
            dailySatDelta += (infrastructureLevel - 50) * 0.005 * dailyFactor; // Altyapı memnuniyeti
            if (inflation > 6) dailySatDelta -= (inflation - 6) * 0.25 * dailyFactor;
            if (crimeRate > 6) dailySatDelta -= crimeRate * 0.6 * dailyFactor;
            if (securityLevel > 7 && governmentType === 'Demokrasi') dailySatDelta -= (securityLevel - 7) * 0.4 * dailyFactor;
            if (governmentType === 'Diktatörlük') dailySatDelta -= 0.8 * dailyFactor;
            if (propagandaEffectWeeks > 0) dailySatDelta += (2 + mediaInfluence/30) * dailyFactor; 
            if (mediaFreedom < 3 && governmentType === 'Demokrasi') dailySatDelta -= (3 - mediaFreedom) * 0.2 * dailyFactor; 
            weeklySatisfactionChange += dailySatDelta;

            let dailyStabDelta = 0;
            dailyStabDelta += (satisfaction - 60) / 20 * dailyFactor;
            if (governmentType === 'Demokrasi' || governmentType === 'Otoriter Demokrasi') dailyStabDelta -= Math.abs(parliamentSupport - 50) / 25 * dailyFactor;
            if ((governmentType === 'Demokrasi' || governmentType === 'Otoriter Demokrasi') && parliamentSupport < 30) dailyStabDelta -= 2 * dailyFactor;
            if (governmentType === 'Diktatörlük') dailyStabDelta += (armyLoyalty - 60) / 15 * dailyFactor;
            else dailyStabDelta += (armyLoyalty - 70) / 25 * dailyFactor;
            if (crimeRate > 10) dailyStabDelta -= (crimeRate - 10) * 0.3 * dailyFactor;
            if (mediaFreedom < 4) dailyStabDelta -= (4 - mediaFreedom) * 0.15 * dailyFactor; 
            weeklyPoliticalStabilityChange += dailyStabDelta;
            
            weeklyCrimeRateChange += ( (-(securityLevel - 4) * 0.12 - (militaryStrengthIndex / 1200) + (100 - politicalStability) / 300) * dailyFactor );
            weeklySecurityPerceptionChange += ( ((securityLevel - 5) * 0.6 + (militaryStrengthIndex / 600) - crimeRate / 3) * dailyFactor);
            
            applyAccumulatedWeeklyChanges(); 

            addLog("Gün sona erdi, gelişmeler yaşandı.", "info", true);
            dayOfWeek++;

            if (dayOfWeek > 7) {
                endWeek(); 
            } else {
                if(completeWeekReportsBtn) completeWeekReportsBtn.disabled = true;
                if(advanceDayBtn) advanceDayBtn.disabled = isAtWar;
            }
            updateGameStats(); 
            enableAllActionButtons();
        }


        function endWeek() { /* ... Altyapı proje kontrolü eklendi ... */
            if (isAtWar) { addLog("Savaş devam ediyor! Haftayı bitiremezsiniz.", "danger"); if(endWeekBtn) endWeekBtn.disabled = true; return; }
            const goScreen = document.getElementById('game-over-screen');
            if (goScreen && goScreen.style.display !== 'none') return;

            // Altyapı Projeleri Kontrolü
            if (transportationInvestmentWeeks > 0) {
                transportationInvestmentWeeks--;
                if (transportationInvestmentWeeks === 0) {
                    addLog("ULAŞIM AĞI GELİŞTİRME PROJESİ TAMAMLANDI!", "success");
                    weeklyInfrastructureChange += 8 + Math.floor(Math.random() * 5); // 8-12 puan
                    weeklyGdpChangeFactor *= 1.005; // GSYİH'ye kalıcı etki
                    weeklySatisfactionChange += 3;
                    if(investTransportationBtn) investTransportationBtn.disabled = false;
                } else {
                    addLog(`Ulaşım ağı projesinin tamamlanmasına ${transportationInvestmentWeeks} hafta kaldı.`, "info");
                }
            }
            if (energyInvestmentWeeks > 0) {
                energyInvestmentWeeks--;
                if (energyInvestmentWeeks === 0) {
                    addLog("ENERJİ ŞEBEKESİ GÜÇLENDİRME PROJESİ TAMAMLANDI!", "success");
                    weeklyInfrastructureChange += 10 + Math.floor(Math.random() * 6); // 10-15 puan
                    weeklyGdpChangeFactor *= 1.003; 
                    weeklyInflationChange -= 0.2; // Enflasyona pozitif etki
                    if(investEnergyBtn) investEnergyBtn.disabled = false;
                } else {
                    addLog(`Enerji şebekesi projesinin tamamlanmasına ${energyInvestmentWeeks} hafta kaldı.`, "info");
                }
            }
            // Haftalık Medya Özgürlüğü Değişimi
            const targetMediaFreedom = mediaFreedomSlider ? parseFloat(mediaFreedomSlider.value) : mediaFreedom;
            if (mediaFreedom !== targetMediaFreedom) { weeklyMediaFreedomChange += (targetMediaFreedom - mediaFreedom) * 0.25; }
            
            if (propagandaEffectWeeks > 0) { propagandaEffectWeeks--; if (propagandaEffectWeeks === 0) { addLog("Devlet propaganda kampanyasının yoğun etkisi sona erdi.", "info"); } }

            // applyAccumulatedWeeklyChanges çağrılmadan önce haftalık biriktiricilere son etkiler eklenir.
            applyAccumulatedWeeklyChanges(); // Tüm biriken haftalık değişiklikleri uygula

            historicalData.weeks.push(week); historicalData.gdp.push(gdp); historicalData.satisfaction.push(satisfaction);
            historicalData.inflation.push(inflation); historicalData.politicalStability.push(politicalStability);
            gdpGrowthFactorGlobalForReport = weeklyGdpChangeFactor; 
            inflationChangeGlobalForReport = weeklyInflationChange; 

            if (week > 1 && Math.random() < 0.30) { triggerRandomEvent(); }
            if ((governmentType === 'Demokrasi' || governmentType === 'Otoriter Demokrasi') && week > 10 && week % (48 + Math.floor(Math.random()*9)) === 0 ) { 
                addLog('SEÇİM ZAMANI!', 'event'); conductElections();
            }
            if (summitPlanned && summitInvitationsSent && !isAtWar) { /* ... Zirve sonuçları ... */ }
            // OYUN SONU KONTROLLERİ 
            if (satisfaction < 5 && politicalStability < 10 && week > 15) { gameOver('Halk isyan etti ve hükümet devrildi! Ülkede kaos hakim.', 'normal'); return; }
            if (budget < -2000000000 && week > 25) { gameOver('Ülke iflas etti! Uluslararası kuruluşlar yönetime el koydu.', 'normal'); return; } 
            if (population < 100000 && week > 20) { gameOver('Nüfus kritik seviyenin altına düştü. Ülke hayalet bir diyara döndü!', 'normal'); return; }
            if (governmentType === 'Diktatörlük' && armyLoyalty < 15 && politicalStability < 25 && week > 20) {
                 if (Math.random() < 0.7) { gameOver('Ordu yönetime el koydu! Diktatörlüğünüz sona erdi.', 'coup'); return; }
                 else { addLog("Ordu içinde büyük bir huzursuzluk var, darbe açıkça konuşuluyor!", "danger"); armyLoyalty = Math.max(0, armyLoyalty -15); }
            }
            if (politicalStability < 5 && satisfaction < 10 && week > 20) { 
                if (Math.random() < 0.5) { gameOver('Ülke iç savaşa sürüklendi! Farklı gruplar kontrolü ele geçirmeye çalışıyor.', 'civil_war'); return; }
                else { addLog("Ülkede büyük çaplı protestolar ve çatışmalar yaşanıyor. İç savaş an meselesi!", "danger"); population -= Math.floor(population * 0.015); gdp *= 0.93; }
            }

            addLog(`----- HAFTA ${week} BİTTİ / HAFTA ${week+1} BAŞLIYOR -----`, 'event');
            week++; 
            dayOfWeek = 1; 
            
            updateGameStats();
            if(typeof updateMinisterAdvice === 'function') updateMinisterAdvice();
            if(typeof updateReports === 'function') updateReports(); 
            enableAllActionButtons(); 
            if(endWeekBtn) endWeekBtn.disabled = isAtWar; 
            if(advanceDayBtn) advanceDayBtn.disabled = isAtWar; 
            if(completeWeekReportsBtn) completeWeekReportsBtn.disabled = isAtWar || (dayOfWeek <=7 && week > 0);
        }
        
        // Diğer tüm fonksiyonlar (triggerRandomEvent, conductElections, updateCabinetDisplay, vb.)
        // ve event listener atamaları (setupAllEventListeners içinde) önceki kod bloklarında olduğu gibi kalacak.
        // Sadece etkiledikleri değişkenler ve log mesajları güncellenmiş olabilir.

        function makeInvestment(name, amount, gdpFactorEffect, inflationEffect, satisfactionEffect, minister) {
            const cost = amount * 1000000;
            if (budget < cost) {
                addLog(`${name} için yeterli bütçe yok! Maliyet: $${cost.toLocaleString()}`, 'warning');
                return false;
            }
            budget -= cost; // Anlık maliyet düşüşü
            let effectiveAmount = cost * (1 - minister.corruption * 0.7); 
            
            // Haftalık etki olarak biriktir
            if(gdpFactorEffect) weeklyGdpChangeFactor *= (1 + (effectiveAmount / gdp * gdpFactorEffect * minister.efficiency));
            if(inflationEffect) weeklyInflationChange += (effectiveAmount / gdp * inflationEffect);
            if(satisfactionEffect) weeklySatisfactionChange += satisfactionEffect * (effectiveAmount / 10000000) * minister.efficiency;

            addLog(`${name}'e $${amount}M yatırım planlandı. Haftalık etkileri olacak. Bakan ${minister.name} (V:${minister.efficiency.toFixed(1)},Y:${minister.corruption.toFixed(1)})`, 'info');
            if (minister.corruption > 0.2 && Math.random() < minister.corruption*2) {
                let lostAmount = cost * minister.corruption * 0.5;
                budget -= lostAmount; 
                addLog(`Bakan ${minister.name}'in yolsuzlukları nedeniyle yatırımın bir kısmı ($${lostAmount.toLocaleString()}) hemen buharlaştı!`, 'danger');
                weeklySatisfactionChange -=2; weeklyPoliticalStabilityChange -=3;
            }
            return true;
        }

        function setupAllEventListeners() {
            if(themeToggleBtn) themeToggleBtn.addEventListener('click', () => {
                document.documentElement.classList.toggle('dark');
                if (document.documentElement.classList.contains('dark')) {
                    themeToggleBtn.textContent = '☀️'; localStorage.setItem('theme', 'dark');
                } else {
                    themeToggleBtn.textContent = '🌙'; localStorage.setItem('theme', 'light');
                }
                if(typeof drawCanvasStats === 'function') drawCanvasStats();
                if(typeof drawReportChart === 'function') drawReportChart();
            });

            if(tabButtons) tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    if(typeof showScreen === 'function') showScreen(button.dataset.tab);
                });
            });
            
            if(taxSlider) taxSlider.addEventListener('input', () => { if(taxSliderValue) taxSliderValue.textContent = taxSlider.value; });
            if(applyTaxBtn) applyTaxBtn.addEventListener('click', () => {
                const newTaxRate = parseFloat(taxSlider.value); const oldTaxes = taxes; taxes = newTaxRate;
                const change = newTaxRate - oldTaxes; if(taxRateEl) taxRateEl.textContent = taxes.toFixed(1);
                let taxMessage = "";
                if (change > 0) { taxMessage = `Vergileri %${taxes.toFixed(1)} oranına yükselttiniz.`; weeklySatisfactionChange -= change * 2.8; weeklyPoliticalStabilityChange -= change * 0.5; if (taxes > 20) taxMessage += " Halk arasında büyük bir hoşnutsuzluk var!"; addLog(taxMessage, 'warning'); }
                else if (change < 0) { taxMessage = `Vergileri %${taxes.toFixed(1)} oranına düşürdünüz.`; weeklySatisfactionChange -= change * 2.0; weeklyPoliticalStabilityChange -= change * 0.2; if (taxes < 8) taxMessage += " Bütçe gelirlerinde ciddi düşüş bekleniyor."; addLog(taxMessage, 'info'); }
                updateGameStats();
            });

            setupInvestmentButtons('economy-investment', 'decrease-economy-investment', 'increase-economy-investment', 1, 100);
            setupInvestmentButtons('education-investment', 'decrease-education-investment', 'increase-education-investment', 1, 50);
            setupInvestmentButtons('health-investment', 'decrease-health-investment', 'increase-health-investment', 1, 50);
            setupInvestmentButtons('culture-investment', 'decrease-culture-investment', 'increase-culture-investment', 1, 30);
            setupInvestmentButtons('police-budget', 'decrease-police-budget', 'increase-police-budget', 1, 20);
            setupInvestmentButtons('recruit-soldiers-input', 'decrease-recruits', 'increase-recruits', 1, 50);

            if(investEconomyBtn) investEconomyBtn.addEventListener('click', () => {
                const amount = parseInt(economyInvestmentInput.value);
                makeInvestment('Ekonomi', amount, 0.12, 0.06, 0.15, cabinet.economy); 
                updateGameStats();
            });
             if(investEducationBtn) investEducationBtn.addEventListener('click', () => {
                const amount = parseInt(educationInvestmentInput.value); 
                if(makeInvestment('Eğitim', amount, 0.01, 0.005, 0.6, cabinet.education)) educationSpending += amount * 1000000 * cabinet.education.efficiency;
                updateGameStats();
            });
            if(investHealthBtn) investHealthBtn.addEventListener('click', () => {
                const amount = parseInt(healthInvestmentInput.value); 
                if(makeInvestment('Sağlık', amount, 0.015, 0.007, 0.75, cabinet.health)) healthSpending += amount*1000000*cabinet.health.efficiency;
                updateGameStats();
            });
            if(promoteCultureBtn) promoteCultureBtn.addEventListener('click', () => {
                const amount = parseInt(cultureInvestmentInput.value); 
                if(makeInvestment('Kültür', amount, 0.005, 0.002, 0.35, cabinet.economy)) cultureSpending += amount*1000000;
                updateGameStats();
            });
            // Altyapı Butonları
            if(investTransportationBtn) investTransportationBtn.addEventListener('click', () => {
                const cost = 30000000; const duration = 4;
                if (transportationInvestmentWeeks > 0) { addLog("Devam eden bir ulaşım ağı projesi zaten var.", "warning"); return; }
                if (budget >= cost) {
                    budget -= cost; transportationInvestmentWeeks = duration;
                    addLog(`Ulaşım ağına yatırım projesi başlatıldı ($${(cost/1000000).toFixed(0)}M). ${duration} hafta sürecek.`, "info");
                    investTransportationBtn.disabled = true; updateGameStats();
                } else { addLog("Ulaşım ağı yatırımı için bütçe yetersiz.", "warning");}
            });
            if(investEnergyBtn) investEnergyBtn.addEventListener('click', () => {
                const cost = 40000000; const duration = 6;
                if (energyInvestmentWeeks > 0) { addLog("Devam eden bir enerji şebekesi projesi zaten var.", "warning"); return; }
                if (budget >= cost) {
                    budget -= cost; energyInvestmentWeeks = duration;
                    addLog(`Enerji şebekesini güçlendirme projesi başlatıldı ($${(cost/1000000).toFixed(0)}M). ${duration} hafta sürecek.`, "info");
                    investEnergyBtn.disabled = true; updateGameStats();
                } else { addLog("Enerji şebekesi yatırımı için bütçe yetersiz.", "warning");}
            });


            if(investGreenEnergyBtn) investGreenEnergyBtn.addEventListener('click', () => { /* ... */ });
            if(developDefenseIndustryBtn) developDefenseIndustryBtn.addEventListener('click', () => { /* ... */ });
            if(socialPolicySlider) socialPolicySlider.addEventListener('input', () => { /* ... */ });
            if(applySocialPolicyBtn) applySocialPolicyBtn.addEventListener('click', () => { /* ... */ });
            // ... (Diğer tüm buton ve slider listener'ları buraya eklenecek) ...

            if(advanceDayBtn) advanceDayBtn.addEventListener('click', () => { /* ... */ });
            if(completeWeekReportsBtn) completeWeekReportsBtn.addEventListener('click', () => { /* ... */ });
            if(endWeekBtn) endWeekBtn.addEventListener('click', () => { if (!isAtWar && (!gameOverScreen || gameOverScreen.style.display === 'none')) endWeek(); });
            if(restartGameBtn) restartGameBtn.addEventListener('click', () => { resetGame(); });

        } 
        
        document.addEventListener('DOMContentLoaded', () => {
            setupAllEventListeners(); 
            initTheme();
            resetGame(); 
        });

    </script>
</body>
</html>
